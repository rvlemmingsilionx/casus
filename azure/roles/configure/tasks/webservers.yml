---
- name: Install packages
  apt:
    pkg:
    - apache2
    - nfs-common
    - php
    - libapache2-mod-php
    - php-mysql
    - php-curl
    - php-gd
    - php-xml
    - php-mbstring
    - php-xmlrpc
    - php-zip
    - php-soap
    - php-intl
    update_cache: yes
  become: yes
  when:
    - "'webservers' in group_names"

- name: NFS Share mounten
  lineinfile:
    path: /etc/fstab
    line: '{{ private_ip_nfs }}:/var/webshare    /var/www/html   nfs auto,nofail,noatime,nolock,intr,tcp,actimeo=1800 0 0'
  become: yes
  when:
    - "'webservers' in group_names"

- name: Reboot servers to mount the share
  reboot:
  become: yes
  when:
    - "'webservers' in group_names"

- name: Set Apache file permissions
  file:
    path: /var/www/html
    owner: www-data
    group: www-data
    mode: '0644'
    recurse: yes
  become: yes
  when: "'webservers' in group_names"

- name: Set Apache folder permissions
  file:
    path: /var/www/html
    owner: www-data
    group: www-data
    mode: '0775'
  become: yes
  when: "'webservers' in group_names"
